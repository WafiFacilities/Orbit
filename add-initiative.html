<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Add New Initiative</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
@font-face { font-family: '72 Condensed'; src: local('72 Condensed'); }

body { font-family: '72 Condensed', Arial; margin:0; background:#f4f6f9; }

.header { display:flex; align-items:center; padding:10px 20px; background:white; border-bottom:2px solid #e0e0e0; }
.header img { height:40px; margin-right:15px; }
.header-title { font-size:22px; font-weight:bold; text-transform:uppercase; }

.layout { display:flex; height:calc(100vh - 62px); }

.sidebar { width:220px; background:#404040; color:white; display:flex; flex-direction:column; padding-top:20px; }
.sidebar h4 { padding:10px 20px; margin:0; }
.sidebar a { color:white; padding:10px 30px; text-decoration:none; }
.sidebar a:hover { background:#505050; }
.sidebar .logout { margin-top:auto; border-top:1px solid #555; }

.main { flex:1; padding:20px; overflow-y:auto; }

.container { background:white; padding:20px; border-radius:6px; box-shadow:0 2px 6px rgba(0,0,0,0.1); max-width:900px; }

.field-row { display:flex; margin-bottom:12px; align-items:center; }
.field-row label { flex:0 0 180px; font-weight:bold; }
.field-row input, .field-row select, .field-row textarea {
  flex:1; padding:6px; border-radius:4px; border:1px solid #ccc;
}

button { padding:8px 16px; background:#76B531; color:white; border:none; border-radius:4px; cursor:pointer; }

.success { color:green; }
.error { color:red; }
</style>
</head>

<body>

<div class="header">
  <img src="wafi-logo.png">
  <h1 class="header-title">FACILITIES – ONE STOP DASHBOARD</h1>
</div>

<div class="layout">

<div class="sidebar">

  <h4>INITIATIVE</h4>
  <a href="index.html">List View</a>
  <a href="add-initiative.html">Add New Initiative</a>
  <a href="dashboard.html">Dashboard</a>

  <h4>FINANCIAL</h4>
  <a href="financial-dashboard.html">Unit Cost Graph</a>
  <a href="unit-cost-tabular.html">Unit Cost Tabular</a>
  <a href="financial-summary.html">Financial Performance</a>
  <a href="financial-monthly-performance.html">Depot Yearly Performance</a>
  <a href="financial-dashboard-overview.html">Category Wise</a>
  <a href="financial-dashboard-category.html">Depot Wise</a>
  <a href="financial-entry.html">Financial Data Entry</a>

  <h4>PEOPLE</h4>
  <a href="people-employees.html">Competency Tracker</a>
  <a href="people-admin.html">Employee Admin</a>
  <a href="people-competency-assignment.html">Competency Assignment</a>

  <a href="#" onclick="logout()" class="logout">Logout</a>

</div>
<div class="main">

<h2>Add New Initiative</h2>

<div class="container">

<form id="initiativeForm">

<div class="field-row">
  <label>Initiative Name:</label>
  <input id="initiative_name" required>
</div>

<div class="field-row">
  <label>Terminal:</label>
  <select id="terminal_name" required>
    <option value="">Select Terminal</option>
    <option>KMR</option><option>CKL</option><option>MCH</option>
    <option>SKP</option><option>DLP</option><option>TJB</option>
    <option>BHK</option><option>SSH</option><option>VHR</option>
    <option>GTI</option><option>MMK</option>
  </select>
</div>

  <div class="field-row">
  <label>Year:</label>
  <select id="year" required>
    <option value="">Select Year</option>
    <option>2025</option>
    <option>2026</option>
    <option>2027</option>
    <option>2028</option>
    <option>2029</option>
    <option>2030</option>
  </select>
</div>

<div class="field-row">
  <label>Description:</label>
  <textarea id="description"></textarea>
</div>

<div class="field-row">
  <label>Start Date:</label>
  <input type="date" id="start_date" required>
</div>

<div class="field-row">
  <label>Target Date:</label>
  <input type="date" id="target_date">
</div>

<div class="field-row">
  <label>Impact Type:</label>
  <select id="impact_type">
    <option value="">Select</option>
    <option>Cost Saving (PKR)</option>
    <option>Cost Avoidance (PKR)</option>
    <option>G2G Improvement (Minutes)</option>
    <option>Capacity Enhancement (KT)</option>
    <option>Other</option>
  </select>
</div>

<div class="field-row">
  <label>Impact Value:</label>
  <input type="number" id="impact_amount">
</div>

<div class="field-row">
  <label>Project Owner Email:</label>
  <input type="email" id="project_owner_email" required>
</div>

<div class="field-row">
  <label>Commentary:</label>
  <textarea id="commentary"></textarea>
</div>

<button type="submit">Submit for Review</button>

<p class="success" id="successMsg" style="display:none;">Submitted – Status set to Under Review</p>
<p class="error" id="errorMsg" style="display:none;"></p>

</form>
</div>
</div>
</div>

<script>
const supabaseUrl = "https://kqhbvmqxrwwspopwckah.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtxaGJ2bXF4cnd3c3BvcHdja2FoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA3MTYyOTAsImV4cCI6MjA4NjI5MjI5MH0.uKfFMK7GBtCR8P5n7hsJlN72-w5h0oyOhuaySphmns8";
const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

document.getElementById('start_date').value = new Date().toISOString().split('T')[0];

async function init(){
 const {data} = await supabaseClient.auth.getSession();
 if(!data.session) window.location.replace("login.html");
}
init();

document.getElementById('initiativeForm').addEventListener('submit', async (e)=>{
 e.preventDefault();

 const newInitiative = {
   initiative_name: initiative_name.value,
   terminal_name: terminal_name.value,
   description: description.value,

   status: "Under Review",
    year: year.value, 
   start_date: start_date.value,
   target_date: target_date.value || null,
   impact_type: impact_type.value,
   impact_amount: parseFloat(impact_amount.value) || null,
   project_owner_email: project_owner_email.value,
   commentary: commentary.value
 };

 const {error} = await supabaseClient.from('initiatives').insert([newInitiative]);

 if(error){
   errorMsg.innerText = error.message;
   errorMsg.style.display="block";
   return;
 }

 initiativeForm.reset();
 start_date.value = new Date().toISOString().split('T')[0];
 successMsg.style.display="block";
});

async function logout(){
 await supabaseClient.auth.signOut();
 window.location.replace("login.html");
}
</script>

</body>
</html>

